<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Cr√©dito</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="translations.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header con selector de idioma -->
        <header class="app-header">
            <h1 data-translate="title">Calculadora de Cr√©ditos</h1>
            <div class="header-controls">
                <div class="language-selector">
                    <label for="languageSelect" data-translate="language">Idioma:</label>
                    <select id="languageSelect" class="form-control form-control--compact">
                        <option value="es">Espa√±ol</option>
                        <option value="en">English</option>
                        <option value="fr">Fran√ßais</option>
                        <option value="de">Deutsch</option>
                        <option value="pt">Portugu√™s</option>
                    </select>
                </div>
            </div>
        </header>

        <!-- Sistema de Pesta√±as -->
        <div class="tabs-container mb-6">
            <div class="tabs">
                <button class="tab-btn active" data-tab="config" data-translate="tabConfig">Datos del Cr√©dito</button>
                <button class="tab-btn" data-tab="contributions" data-translate="tabContributions">Aportes
                    Extra</button>
                <button class="tab-btn" data-tab="rates" data-translate="tabRates">Cambios de Tasa</button>
                <button class="tab-btn" data-tab="manual" data-translate="userManual">Manual de Usuario</button>
            </div>
        </div>

        <!-- Contenido Pesta√±a 1: Configuraci√≥n -->
        <div id="tab-config" class="tab-content active transition-fade">
            <!-- Configuraci√≥n B√°sica (Full Width) -->
            <div class="card mb-8">
                <!-- Columna 1: Configuraci√≥n B√°sica -->
                <div class="card">
                    <div class="card__header">
                        <h2 data-translate="loanConfig">Configuraci√≥n del Pr√©stamo</h2>
                    </div>
                    <div class="card__body">
                        <div class="form-group">
                            <label for="currency" class="form-label" data-translate="currency">Moneda</label>
                            <select id="currency" class="form-control">
                                <option value="COP" selected>Peso Colombiano (COP)</option>
                                <option value="USD">D√≥lar Estadounidense (USD)</option>
                                <option value="EUR">Euro (EUR)</option>
                                <option value="MXN">Peso Mexicano (MXN)</option>
                                <option value="PEN">Sol Peruano (PEN)</option>
                                <option value="ARS">Peso Argentino (ARS)</option>
                                <option value="CLP">Peso Chileno (CLP)</option>
                                <option value="BRL">Real Brasile√±o (BRL)</option>
                                <option value="BOB">Boliviano (BOB)</option>
                                <option value="UYU">Peso Uruguayo (UYU)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="loanAmount" class="form-label" data-translate="loanAmount">Monto del
                                Pr√©stamo</label>
                            <input type="text" id="loanAmount" class="form-control" placeholder="200,000,000"
                                inputmode="numeric">
                        </div>

                        <!-- Input de Tasa Compacto -->
                        <div class="form-group">
                            <label class="form-label" data-translate="interestRate">Tasa de Inter√©s</label>
                            <div class="input-group-compact">
                                <input type="text" id="interestRate" class="form-control" inputmode="decimal"
                                    placeholder="10.00%">
                                <select id="rateType" class="form-control">
                                    <!-- Options generated dynamically -->
                                </select>
                                <select id="ratePeriod" class="form-control">
                                    <option value="annual" data-translate="annual" selected>Anual</option>
                                    <option value="monthly" data-translate="monthly">Mensual</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="term" class="form-label" data-translate="term">Plazo (meses)</label>
                            <input type="number" id="term" class="form-control" value="180" min="1">
                        </div>

                        <div class="form-group">
                            <label for="disbursementDate" class="form-label" data-translate="disbursementDate">Fecha de
                                Desembolso</label>
                            <input type="date" id="disbursementDate" class="form-control" value="2025-06-01">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido Pesta√±a 2: Aportes -->
        <div id="tab-contributions" class="tab-content transition-fade">
            <div class="card mb-8">
                <div class="card__header">
                    <h2 data-translate="extraContributions">Aportes Extraordinarios</h2>
                </div>
                <div class="card__body">
                    <div class="form-group">
                        <label for="contributionType" class="form-label" data-translate="contributionType">Tipo de
                            Aporte</label>
                        <select id="contributionType" class="form-control">
                            <option value="single" data-translate="single">√önico</option>
                            <option value="recurring" data-translate="recurring">Recurrente</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="contributionAmount" class="form-label" data-translate="amount">Monto</label>
                        <input type="text" id="contributionAmount" class="form-control" placeholder="0"
                            inputmode="numeric">
                    </div>

                    <div class="form-group">
                        <label for="contributionMonth" class="form-label" data-translate="applicationMonth">Mes de
                            Aplicaci√≥n</label>
                        <input type="number" id="contributionMonth" class="form-control" min="1" value="1">
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-translate="strategy">Estrategia</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="contributionStrategy" value="Reducir Plazo" checked>
                                <span data-translate="reduceTerm">Reducir Plazo (mantener cuota)</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="contributionStrategy" value="Reducir Cuota">
                                <span data-translate="reducePayment">Reducir Cuota (mantener plazo)</span>
                            </label>
                        </div>
                    </div>

                    <button type="button" id="addContribution" class="btn btn--primary btn--full-width mt-8"
                        data-translate="addContribution">Agregar Aporte</button>

                    <div id="contributionsList" class="contributions-list"></div>
                </div>
            </div>
        </div>

        <!-- Contenido Pesta√±a 3: Tasas -->
        <div id="tab-rates" class="tab-content transition-fade">
            <div class="card mb-8">
                <div class="card__header">
                    <h2 data-translate="rateChanges">Cambios de Tasa</h2>
                </div>
                <div class="card__body">
                    <!-- Input de Nueva Tasa Compacto -->
                    <div class="form-group">
                        <label class="form-label" data-translate="newRate">Nueva Tasa</label>
                        <div class="input-group-compact">
                            <input type="text" id="newRate" class="form-control" inputmode="decimal"
                                placeholder="10.00%">
                            <select id="newRateType" class="form-control">
                                <!-- Options generated dynamically -->
                            </select>
                            <select id="newRatePeriod" class="form-control">
                                <option value="annual" data-translate="annual" selected>Anual</option>
                                <option value="monthly" data-translate="monthly">Mensual</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="rateChangeMonth" class="form-label" data-translate="applicationMonth">Mes de
                            Aplicaci√≥n</label>
                        <input type="number" id="rateChangeMonth" class="form-control" min="1" value="1">
                    </div>

                    <button type="button" id="addRateChange" class="btn btn--primary btn--full-width mt-8"
                        data-translate="addRateChange">Agregar Cambio de Tasa</button>

                    <div id="rateChangesList" class="rate-changes-list"></div>

                    <p class="info-text mt-8">
                        <strong data-translate="note">Nota:</strong> <span data-translate="rateChangeNote">Los cambios
                            de tasa afectan el valor de la cuota mensual bas√°ndose en el saldo restante.</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenido Pesta√±a 4: Manual -->
    <div id="tab-manual" class="tab-content transition-fade">
        <div class="card mb-8">
            <div class="card__header">
                <h2 data-translate="userManual">Manual de Usuario</h2>
            </div>
            <div class="card__body manual-content-body">
                <h3 data-translate="instructions">Instrucciones de Uso</h3>
                <h4 data-translate="calculationMethod">üìã M√©todo de C√°lculo</h4>
                <p data-translate="frenchMethodDesc">Esta calculadora utiliza el m√©todo franc√©s de amortizaci√≥n, que es
                    el m√°s com√∫n en Latinoam√©rica. En este m√©todo:</p>
                <ul>
                    <li data-translate="constantPayments">Las cuotas son constantes (mismo valor todos los meses)</li>
                    <li data-translate="moreInterestInitially">Al inicio se pagan m√°s intereses y menos capital</li>
                    <li data-translate="moreCapitalFinally">Al final se pagan m√°s capital y menos intereses</li>
                    <li data-translate="balanceDecrease">El saldo disminuye gradualmente hasta llegar a cero</li>
                </ul>

                <hr class="my-6 border-gray-200 dark:border-gray-700">

                <h4 data-translate="basicConfig">‚öôÔ∏è 1. Configuraci√≥n B√°sica</h4>
                <ul>
                    <li data-translate="currencyDesc">Selecciona la moneda del pr√©stamo. Cada moneda tiene su formato
                        espec√≠fico.</li>
                    <li data-translate="amountDesc">Ingresa el valor del pr√©stamo con separadores de miles autom√°ticos.
                    </li>
                    <li data-translate="rateDesc">Ingresa el porcentaje sin s√≠mbolo %. Acepta hasta 2 decimales.</li>
                    <li data-translate="rateTypeDesc">Efectiva est√° seleccionada por defecto.</li>
                    <li data-translate="ratePeriodDesc">Selecciona si la tasa es anual o mensual.</li>
                    <li data-translate="termDesc">N√∫mero de meses del pr√©stamo (por defecto 180 meses = 15 a√±os).</li>
                    <li data-translate="disbursementDesc">La primera cuota se paga exactamente un mes despu√©s.</li>
                </ul>

                <hr class="my-6 border-gray-200 dark:border-gray-700">

                <h4 data-translate="extraContributions">üí∞ 2. Aportes Extraordinarios</h4>
                <p data-translate="strategiesHeader">Estrategias:</p>
                <ul>
                    <li data-translate="singleDesc">Se aplica solo en el mes especificado.</li>
                    <li data-translate="recurringDesc">Se aplica desde el mes inicial hasta el final del pr√©stamo.</li>
                </ul>

                <hr class="my-6 border-gray-200 dark:border-gray-700">

                <h4 data-translate="rateChanges">üìâ 3. Cambios de Tasa</h4>
                <ul>
                    <li data-translate="rateChangesNote">Los cambios de tasa se aplican √öNICAMENTE como reducci√≥n de
                        cuota.</li>
                    <li data-translate="rateChangesNote2">No afectan las estrategias de aportes previamente
                        configuradas.</li>
                    <li data-translate="rateChangesNote3">La nueva tasa recalcula solo la cuota mensual basada en el
                        saldo restante.</li>
                </ul>

                <hr class="my-6 border-gray-200 dark:border-gray-700">

                <h4 data-translate="paymentDates">üìÖ 4. Fechas de Pago</h4>
                <ul>
                    <li data-translate="firstPaymentDesc">El primer pago es exactamente un mes despu√©s del desembolso.
                    </li>
                    <li data-translate="firstPaymentExample">Si el desembolso es el 1 de junio, el primer pago es el 1
                        de julio.</li>
                    <li data-translate="paymentDayDesc">Los pagos mantienen el mismo d√≠a del mes cuando es posible.</li>
                    <li data-translate="dateFormatDesc">El formato de fecha se ajusta autom√°ticamente seg√∫n la moneda
                        seleccionada.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Bot√≥n de C√°lculo (Visible ahora) -->
    <div class="calc-button-container">
        <button type="button" id="calculateAmortization" class="btn btn--primary btn--lg"
            data-translate="calculateAmortization">Calcular Amortizaci√≥n</button>
    </div>

    <!-- Resultados (Full Width) -->
    <div id="results" class="results-section hidden">
        <!-- Resumen -->
        <div class="card">
            <div class="card__header">
                <h2 data-translate="financialSummary">Resumen Financiero</h2>
            </div>
            <div class="card__body">
                <div id="summaryContent" class="summary-grid"></div>
            </div>
        </div>

        <!-- Gr√°ficos en Grid de 2 -->
        <div class="charts-grid">
            <!-- Gr√°fico Saldo -->
            <div class="card">
                <div class="card__header">
                    <h2 data-translate="balanceEvolution">Evoluci√≥n del Saldo</h2>
                </div>
                <div class="card__body">
                    <div class="chart-container">
                        <canvas id="balanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Gr√°fica de Distribuci√≥n -->
            <div class="card">
                <div class="card__header">
                    <h2 data-translate="paymentDistribution">Distribuci√≥n de Pagos</h2>
                </div>
                <div class="card__body">
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla de Amortizaci√≥n con Paginaci√≥n -->
        <div class="card">
            <div class="card__header">
                <div class="flex justify-between items-center wrap-mobile">
                    <h2 data-translate="amortizationTable">Tabla de Amortizaci√≥n</h2>
                    <button type="button" id="exportCsv" class="btn btn--secondary btn--sm"
                        data-translate="exportCsv">Exportar CSV</button>
                </div>
            </div>
            <div class="card__body">
                <div class="table-container">
                    <table id="amortizationTable" class="amortization-table">
                        <thead>
                            <tr>
                                <th data-translate="month">Mes</th>
                                <th data-translate="date">Fecha</th>
                                <th data-translate="payment">Cuota</th>
                                <th data-translate="principal">Capital</th>
                                <th data-translate="interest">Inter√©s</th>
                                <th data-translate="extraContribution">Aporte Extra</th>
                                <th data-translate="balance">Saldo</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <!-- Controles de Paginaci√≥n -->
                <div class="pagination-controls">
                    <button id="prevPage" class="btn btn--outline btn--sm" disabled>&larr; <span
                            data-translate="prev">Anterior</span></button>
                    <span id="pageInfo" class="page-info">P√°gina 1 de 1</span>
                    <button id="nextPage" class="btn btn--outline btn--sm" disabled><span
                            data-translate="next">Siguiente</span> &rarr;</button>
                </div>
            </div>
        </div>
    </div>


    </div>

    <!-- Pie de p√°gina Simplificado -->
    <footer class="app-footer-simple">
        <p>
            v1.1.2 - <a href="https://github.com/fugazi" target="_blank" rel="noopener noreferrer">GitHub</a>
            | <a href="mailto:douglas@douglasfugazi.co">douglas@douglasfugazi.co</a>
        </p>
    </footer>

    <script src="app.js"></script>
</body>

</html>